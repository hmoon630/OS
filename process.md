---
description: 운영체제의 핵심 개념 중 하나인 프로세스(process)에 대해 설명한다.
---

# 프로세스

프로세스(process)는 일반적으로 **실행 중인 프로그램**으로 정의한다.

컴퓨터는 수백개의 프로세스를 사용자가 신경쓰지 않고도 바로 실행시켜 쓸 수 있도록 한다. 이것이 가능한 이유는 운영체제가 CPU를 **가상화**하기 때문이다.

**시분할(time sharing)** 이라는 기법을 사용하는데 하나의 프로세스를 실행하고 중단시키고, 다른 프로세스를 실행하는 작업을 반복하면서 마치 여러개의 CPU를 사용하는 것 처럼 만든다. 다만 시분할 기법은 CPU를 공유하기 때문에 각 프로세스의 성능은 낮아진다.

이 CPU 가상화를 효율적으로 구현하기 위해 **문맥 교환(context switching)** 을 하게 되는데, 이는 프로세스를 잠시 중단하고 다른 프로세스를 실행하는 것을 의미한다. 

또한 어떤 프로세스를 실행 할지는 **스케줄링 정책(scheduling policy)** 에 의해 결정된다.


# 프로세스에서 사용되는 레지스터

- 프로그램 카운터(program counter, PC): 프로그램의 어느 명령어가 실행 중인지를 가리키는 레지스터. 명령어 포인터(instruction pointer, IP)라고도 불린다.

- 스택 포인터(stack pointer): 함수가 호출되고 현재 가리키고있는 스택 메모리 주소를 저장하는 레지스터

- 프레임 포인터(frame pointer): 함수가 호출되기 이전의 스택 메모리 주소를 저장하는 레지스터

# 프로세스 생성

프로그램 실행을 위해서 OS는 코드와 정적 데이터를 메모리, 프로세스의 주소 공간에 탑재(load)한다. 과거에는 프로그램 실행 전에 모두 탑재하였지만, 현재는 페이징(paging)과 스와핑(swapping) 동작을 통해 탑재를 늦춘다. (이는 추후 메모리 가상화에서 다룬다.)

코드와 정적 데이터가 탑재된 후 OS가 추가로 해야할 일이 있다. 특정 크깅의 메모리 공간이 스택의 용도로 할당되어야 한다. C언어의 경우 지역 변수, 함수 인자, 리턴 주소 등을 저장할 때 스택을 사용한다. 또한 main() 함수의 인자인 argc와 argv 벡터를 사용해 스택을 초기화 한다.

OS는 프로그램의 힙(heap)을 위한 영역도 할당한다. 힙은 동적으로 할당된 데이터를 저장하기 위해 사용된다. malloc()을 호출하여 할당하고 free()를 호출해 공간을 반환한다.

OS는 입출력과 관계된 초기화 작업도 수행하게 된다. 프로세스는 STDIN, STDOUT, STDERR 장치에 해당하는 3개의 파일 디스크립터(file descriptor)를 갖는다. (파일 디스크립터는 추후 영속성에서 다룬다.)

프로세스가 생성되는 과정을 정리하면 다음과 같다.
- 코드와 정적 데이터를 메모리에 탑재한다.
- 스택과 힙을 생성하고 초기화 한다.
- 입출력 스트림을 설정한다.
- 프로그램의 시작 지점(entry point), main()에서부터 프로그램을 실행한다.

# 프로세스 상태 

프로세스는 다음의 3개의 상태 중의 하나로 존재하게 된다.
- 실행 (Running): 프로세서에서 실행 중인 상태이다. 즉, 명령어를 실행중이다.
- 준비 (Ready): 실행할 준비가 되어있지만 프로세서에서 다른 작업을 수행중이다.
- 대기 (Blocked): 프로세스가 다른 사건을 기다리는 동안 프로세스를 중단된 상태이다. 하나의 예로 프로세스가 다른 장치에 입출력 요청 하였을 때 입출력이 완료될 때까지 대기 상태가 된다.

추가적으로 위의 상태 외에 프로세스가 완전히 생성되기 이전인 초기(initial)상태와 프로세스가 종료되었지만 자원들이 아직 반환되지 않은 경우 최종(final)상태도 있다. (UNIX 기반 체제에서는 이를 zombie 상태라고 부른다.)


